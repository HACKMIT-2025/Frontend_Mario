<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mario Game API Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Courier New', monospace;
            background: #2c3e50;
            color: white;
        }
        .controls {
            margin-bottom: 20px;
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover {
            background: #2980b9;
        }
        button:active {
            transform: scale(0.95);
        }
        .section {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        h2 {
            margin-top: 0;
            color: #3498db;
        }
        .info {
            background: rgba(52, 152, 219, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        #game-frame {
            width: 100%;
            height: 600px;
            border: 3px solid #3498db;
            border-radius: 10px;
            background: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ® Mario Game Engine API Test</h1>

    <div class="controls">
        <div class="info">
            <strong>æ¸¸æˆæ§åˆ¶ï¼š</strong> æ–¹å‘é”®/WASDç§»åŠ¨ | ç©ºæ ¼è·³è·ƒ | Shiftå¥”è·‘ | Xå‘å°„ç«çƒ
        </div>

        <div class="section">
            <h2>ğŸ“ é¢„è®¾å…³å¡</h2>
            <button onclick="loadClassicLevel()">ç»å…¸å…³å¡</button>
            <button onclick="loadUndergroundLevel()">åœ°ä¸‹å…³å¡</button>
            <button onclick="loadCastleLevel()">åŸå ¡å…³å¡</button>
            <button onclick="loadCustomLevel()">è‡ªå®šä¹‰æµ‹è¯•å…³å¡</button>
        </div>

        <div class="section">
            <h2>ğŸ¯ æ¸¸æˆæ§åˆ¶</h2>
            <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
            <button onclick="pauseGame()">æš‚åœ/ç»§ç»­</button>
            <button onclick="resetGame()">é‡ç½®æ¸¸æˆ</button>
            <button onclick="clearLevel()">æ¸…ç©ºå…³å¡</button>
        </div>

        <div class="section">
            <h2>ğŸ”§ åŠ¨æ€æ·»åŠ å…ƒç´ </h2>
            <button onclick="addRandomPlatform()">æ·»åŠ éšæœºå¹³å°</button>
            <button onclick="addRandomEnemy()">æ·»åŠ éšæœºæ•Œäºº</button>
            <button onclick="addRandomCoins()">æ·»åŠ éšæœºé‡‘å¸</button>
            <button onclick="addRandomPowerUp()">æ·»åŠ éšæœºé“å…·</button>
        </div>

        <div class="section">
            <h2>ğŸ—ï¸ å…³å¡æ„å»ºå™¨</h2>
            <button onclick="buildSimpleLevel()">æ„å»ºç®€å•å…³å¡</button>
            <button onclick="buildComplexLevel()">æ„å»ºå¤æ‚å…³å¡</button>
            <button onclick="buildFromImageData()">æ¨¡æ‹Ÿå›¾åƒè¯†åˆ«æ„å»º</button>
        </div>
    </div>

    <iframe id="game-frame" src="http://localhost:5174"></iframe>

    <script>
        // ç­‰å¾…æ¸¸æˆåŠ è½½å®Œæˆ
        let gameWindow;
        let api;

        setTimeout(() => {
            gameWindow = document.getElementById('game-frame').contentWindow;
            api = gameWindow.MarioGameAPI;
            console.log('API Loaded:', api);
        }, 1000);

        function startGame() {
            if (api) {
                api.startGame();
                console.log('Game started');
            }
        }

        function pauseGame() {
            if (api) {
                api.pauseGame();
                console.log('Game paused/resumed');
            }
        }

        function resetGame() {
            if (api) {
                api.resetGame();
                console.log('Game reset');
            }
        }

        function clearLevel() {
            if (api) {
                api.clearLevel();
                console.log('Level cleared');
            }
        }

        function loadClassicLevel() {
            if (!api) return;

            api.clearLevel();

            // åœ°é¢
            api.addPlatform(0, 500, 3000, 76, 'ground');

            // ç¬¬ä¸€åŒºåŸŸ - åŸºç¡€å¹³å°å’Œé‡‘å¸
            for (let i = 0; i < 5; i++) {
                api.addCoin(200 + i * 40, 350);
            }
            api.addPlatform(300, 400, 100, 20, 'platform');

            // ç®¡é“åŒºåŸŸ
            api.addPlatform(500, 400, 64, 100, 'pipe');
            api.addEnemy(450, 450, 'goomba');

            // é˜¶æ¢¯
            for (let i = 0; i < 4; i++) {
                const width = 32 * (4 - i);
                const x = 700 + i * 32;
                const y = 500 - i * 32;
                api.addPlatform(x, y, width, 32, 'brick');
            }

            // é—´éš™åŒºåŸŸä¸æµ®åŠ¨å¹³å°
            api.addPlatform(900, 350, 80, 20, 'platform');
            api.addPlatform(1020, 350, 80, 20, 'platform');
            api.addPlatform(1140, 350, 80, 20, 'platform');

            // é‡‘å¸è¡Œ
            for (let i = 0; i < 3; i++) {
                api.addCoin(920 + i * 40, 300);
            }
            for (let i = 0; i < 3; i++) {
                api.addCoin(1040 + i * 40, 300);
            }

            // é—®å·ç –å—ä¸é“å…·
            api.addPlatform(1400, 350, 32, 32, 'question');
            api.addPowerUp(1400, 318, 'mushroom');

            // æ•ŒäººåŒºåŸŸ
            api.addEnemy(1500, 450, 'koopa');
            api.addEnemy(1600, 450, 'goomba');
            api.addEnemy(1700, 450, 'goomba');

            // æœ€ç»ˆåŒºåŸŸ
            for (let i = 0; i < 8; i++) {
                const width = 32 * (8 - i);
                const x = 2000 + i * 32;
                const y = 500 - i * 32;
                api.addPlatform(x, y, width, 32, 'brick');
            }

            api.addPlatform(2300, 200, 100, 20, 'platform');
            api.addPowerUp(2350, 150, 'star');

            // ç»ˆç‚¹ç®¡é“
            api.addPlatform(2500, 350, 64, 150, 'pipe');

            api.setPlayerStart(100, 400);
            api.buildLevel();
            api.startGame();

            console.log('Classic level loaded');
        }

        function loadUndergroundLevel() {
            if (!api) return;

            api.clearLevel();

            // åœ°ä¸‹åœ°æ¿å’Œå¤©èŠ±æ¿
            api.addPlatform(0, 550, 3000, 26, 'underground');
            api.addPlatform(0, 0, 3000, 50, 'underground');

            // å…¥å£ç®¡é“
            api.addPlatform(100, 450, 64, 100, 'pipe');

            // åœ°ä¸‹éšœç¢
            for (let i = 0; i < 10; i++) {
                const x = 300 + i * 200;
                if (i % 2 === 0) {
                    api.addPlatform(x, 450, 80, 100, 'underground');
                } else {
                    api.addPlatform(x, 200, 80, 100, 'underground');
                }
                api.addCoin(x + 40, i % 2 === 0 ? 400 : 350);
            }

            // æ•Œäºº
            api.addEnemy(500, 500, 'goomba');
            api.addEnemy(900, 500, 'koopa');
            api.addEnemy(1300, 500, 'goomba');

            // é“å…·
            api.addPowerUp(1500, 400, 'flower');

            // å‡ºå£ç®¡é“
            api.addPlatform(2500, 450, 64, 100, 'pipe');

            api.setPlayerStart(200, 450);
            api.buildLevel();
            api.startGame();

            console.log('Underground level loaded');
        }

        function loadCastleLevel() {
            if (!api) return;

            api.clearLevel();

            // åŸå ¡åœ°æ¿
            api.addPlatform(0, 550, 3000, 26, 'castle');

            // å²©æµ†å‘ä¸å¹³å°
            for (let i = 0; i < 5; i++) {
                const x = 300 + i * 400;
                api.addPlatform(x, 500, 50, 50, 'castle');
                api.addPlatform(x + 150, 450, 50, 100, 'castle');
                api.addPlatform(x + 300, 400, 50, 150, 'castle');
            }

            // ç§»åŠ¨å¹³å°
            api.addPlatform(600, 350, 80, 20, 'platform');
            api.addPlatform(1000, 300, 80, 20, 'platform');
            api.addPlatform(1400, 350, 80, 20, 'platform');

            // ç«æ£’éšœç¢
            api.addEnemy(800, 300, 'firebar');
            api.addEnemy(1200, 350, 'firebar');
            api.addEnemy(1600, 300, 'firebar');

            // é²æ³½
            api.addEnemy(2400, 450, 'bowser');

            // é€šå¾€æ–§å¤´çš„æ¡¥
            api.addPlatform(2200, 450, 300, 20, 'bridge');

            api.setPlayerStart(100, 450);
            api.buildLevel();
            api.startGame();

            console.log('Castle level loaded');
        }

        function loadCustomLevel() {
            if (!api) return;

            api.clearLevel();

            // æµ‹è¯•æ‰€æœ‰APIåŠŸèƒ½
            // åŸºç¡€åœ°é¢
            api.addPlatform(0, 500, 2000, 76, 'ground');

            // å„ç§ç±»å‹çš„å¹³å°
            api.addPlatform(200, 400, 100, 20, 'platform');
            api.addPlatform(350, 350, 32, 32, 'brick');
            api.addPlatform(450, 350, 32, 32, 'question');
            api.addPlatform(550, 400, 64, 100, 'pipe');

            // æ‰€æœ‰ç±»å‹çš„æ•Œäºº
            api.addEnemy(700, 450, 'goomba');
            api.addEnemy(800, 450, 'koopa');
            api.addEnemy(900, 300, 'firebar');

            // æ‰€æœ‰ç±»å‹çš„é“å…·
            api.addPowerUp(1000, 400, 'mushroom');
            api.addPowerUp(1100, 400, 'flower');
            api.addPowerUp(1200, 400, 'star');

            // å¤§é‡é‡‘å¸æµ‹è¯•
            for (let i = 0; i < 10; i++) {
                api.addCoin(1300 + i * 30, 350);
            }

            // å¤æ‚å¹³å°ç»“æ„
            for (let i = 0; i < 5; i++) {
                api.addPlatform(1600 + i * 100, 400 - i * 30, 80, 20, 'platform');
            }

            api.setPlayerStart(50, 400);
            api.buildLevel();
            api.startGame();

            console.log('Custom test level loaded');
        }

        function addRandomPlatform() {
            if (!api) return;
            const x = Math.random() * 1500 + 200;
            const y = Math.random() * 200 + 300;
            const types = ['platform', 'brick', 'question'];
            const type = types[Math.floor(Math.random() * types.length)];
            api.addPlatform(x, y, 80, 20, type);
            api.buildLevel();
            console.log(`Added platform at (${x.toFixed(0)}, ${y.toFixed(0)})`);
        }

        function addRandomEnemy() {
            if (!api) return;
            const x = Math.random() * 1500 + 200;
            const types = ['goomba', 'koopa'];
            const type = types[Math.floor(Math.random() * types.length)];
            api.addEnemy(x, 450, type);
            api.buildLevel();
            console.log(`Added ${type} at x=${x.toFixed(0)}`);
        }

        function addRandomCoins() {
            if (!api) return;
            const startX = Math.random() * 1000 + 200;
            const y = Math.random() * 150 + 300;
            const count = Math.floor(Math.random() * 5) + 3;
            for (let i = 0; i < count; i++) {
                api.addCoin(startX + i * 40, y);
            }
            api.buildLevel();
            console.log(`Added ${count} coins at (${startX.toFixed(0)}, ${y.toFixed(0)})`);
        }

        function addRandomPowerUp() {
            if (!api) return;
            const x = Math.random() * 1500 + 200;
            const y = Math.random() * 150 + 300;
            const types = ['mushroom', 'flower', 'star'];
            const type = types[Math.floor(Math.random() * types.length)];
            api.addPowerUp(x, y, type);
            api.buildLevel();
            console.log(`Added ${type} at (${x.toFixed(0)}, ${y.toFixed(0)})`);
        }

        function buildSimpleLevel() {
            if (!api) return;

            api.clearLevel();

            // ç®€å•çš„å¹³åœ°å…³å¡
            api.addPlatform(0, 500, 2000, 76, 'ground');

            // å‡ ä¸ªå¹³å°
            api.addPlatform(300, 400, 100, 20, 'platform');
            api.addPlatform(500, 350, 100, 20, 'platform');
            api.addPlatform(700, 300, 100, 20, 'platform');

            // ä¸€äº›é‡‘å¸
            for (let i = 0; i < 20; i++) {
                api.addCoin(200 + i * 50, 250);
            }

            // å‡ ä¸ªæ•Œäºº
            api.addEnemy(400, 450, 'goomba');
            api.addEnemy(600, 450, 'goomba');

            // ä¸€ä¸ªé“å…·
            api.addPowerUp(800, 250, 'mushroom');

            api.setPlayerStart(100, 400);
            api.buildLevel();
            api.startGame();

            console.log('Simple level built');
        }

        function buildComplexLevel() {
            if (!api) return;

            api.clearLevel();

            // å¤æ‚çš„å¤šå±‚å…³å¡
            api.addPlatform(0, 550, 3000, 26, 'ground');

            // åˆ›å»ºå¤šå±‚å¹³å°ç»“æ„
            for (let layer = 0; layer < 3; layer++) {
                for (let i = 0; i < 10; i++) {
                    const x = 200 + i * 150;
                    const y = 450 - layer * 100;
                    api.addPlatform(x, y, 80, 20, 'platform');

                    // åœ¨å¹³å°ä¸Šæ·»åŠ é‡‘å¸
                    if (Math.random() > 0.5) {
                        api.addCoin(x + 40, y - 50);
                    }
                }
            }

            // æ·»åŠ å„ç§æ•Œäºº
            for (let i = 0; i < 8; i++) {
                const x = 300 + i * 200;
                const types = ['goomba', 'koopa'];
                const type = types[Math.floor(Math.random() * types.length)];
                api.addEnemy(x, 500, type);
            }

            // æ·»åŠ é“å…·
            api.addPowerUp(500, 200, 'mushroom');
            api.addPowerUp(1000, 200, 'flower');
            api.addPowerUp(1500, 200, 'star');

            // æ·»åŠ ç®¡é“
            api.addPlatform(1800, 450, 64, 100, 'pipe');
            api.addPlatform(2000, 400, 64, 150, 'pipe');
            api.addPlatform(2200, 350, 64, 200, 'pipe');

            api.setPlayerStart(100, 450);
            api.buildLevel();
            api.startGame();

            console.log('Complex level built');
        }

        function buildFromImageData() {
            if (!api) return;

            // æ¨¡æ‹Ÿä»å›¾åƒè¯†åˆ«è·å¾—çš„æ•°æ®
            const imageData = [
                { type: 'ground', x: 0, y: 500, width: 2000, height: 76 },
                { type: 'platform', x: 300, y: 400, width: 100, height: 20 },
                { type: 'platform', x: 500, y: 350, width: 100, height: 20 },
                { type: 'brick', x: 700, y: 350, width: 32, height: 32 },
                { type: 'brick', x: 732, y: 350, width: 32, height: 32 },
                { type: 'brick', x: 764, y: 350, width: 32, height: 32 },
                { type: 'question', x: 796, y: 350, width: 32, height: 32 },
                { type: 'pipe', x: 1000, y: 400, width: 64, height: 100 },
                { type: 'coin', x: 350, y: 300 },
                { type: 'coin', x: 550, y: 250 },
                { type: 'coin', x: 750, y: 250 },
                { type: 'enemy', x: 400, y: 450, enemyType: 'goomba' },
                { type: 'enemy', x: 600, y: 450, enemyType: 'koopa' },
                { type: 'powerup', x: 796, y: 318, powerType: 'mushroom' },
                { type: 'player', x: 100, y: 400 }
            ];

            api.clearLevel();

            // è§£æå›¾åƒè¯†åˆ«æ•°æ®
            imageData.forEach(obj => {
                switch(obj.type) {
                    case 'platform':
                    case 'ground':
                    case 'brick':
                    case 'question':
                    case 'pipe':
                        api.addPlatform(obj.x, obj.y, obj.width, obj.height, obj.type);
                        break;
                    case 'coin':
                        api.addCoin(obj.x, obj.y);
                        break;
                    case 'enemy':
                        api.addEnemy(obj.x, obj.y, obj.enemyType);
                        break;
                    case 'powerup':
                        api.addPowerUp(obj.x, obj.y, obj.powerType);
                        break;
                    case 'player':
                        api.setPlayerStart(obj.x, obj.y);
                        break;
                }
            });

            api.buildLevel();
            api.startGame();

            console.log('Level built from simulated image data');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åŠ è½½ç»å…¸å…³å¡
        window.addEventListener('load', () => {
            setTimeout(() => {
                loadClassicLevel();
            }, 1500);
        });
    </script>
</body>
</html>