<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mario Game - Play</title>
    <style>
      /* å®Œæ•´æ¸¸æˆé¡µé¢æ ·å¼ */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html, body {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        font-family: 'Arial', sans-serif;
        overflow-x: hidden;
      }

      .header {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      }

      .header h1 {
        font-size: 24px;
        font-weight: bold;
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .btn {
        background: #4CAF50;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: background 0.3s;
      }

      .btn:hover {
        background: #45a049;
      }

      .btn.secondary {
        background: #2196F3;
      }

      .btn.secondary:hover {
        background: #1976D2;
      }

      .btn.danger {
        background: #f44336;
      }

      .btn.danger:hover {
        background: #d32f2f;
      }

      #app {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .game-section {
        flex: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      #game-container {
        position: relative;
        width: 1024px;
        height: 576px;
        max-width: 95vw;
        max-height: calc(100vh - 200px);
        background: #000;
        border-radius: 10px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.4);
        overflow: hidden;
        border: 3px solid #333;
      }

      #game-canvas {
        display: block;
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      #game-ui {
        position: absolute;
        top: 15px;
        left: 15px;
        z-index: 100;
        background: linear-gradient(45deg, rgba(0,0,0,0.8), rgba(0,0,0,0.6));
        padding: 10px 15px;
        border-radius: 8px;
        color: white;
        font-weight: bold;
        font-size: 16px;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        border: 1px solid rgba(255,255,255,0.2);
      }

      .ui-item {
        margin-right: 20px;
        display: inline-block;
      }

      .ui-item:last-child {
        margin-right: 0;
      }

      /* Loadingå’Œé”™è¯¯çŠ¶æ€ */
      #loading, #error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 200;
      }

      #loading {
        color: white;
        font-size: 18px;
      }

      .spinner {
        border: 4px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top: 4px solid white;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      #error {
        color: #ff6b6b;
        background: rgba(0,0,0,0.9);
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        border: 2px solid #ff6b6b;
      }

      /* ä¿¡æ¯é¢æ¿ */
      .info-panel {
        background: rgba(255,255,255,0.95);
        padding: 20px;
        margin: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      }

      .info-panel h3 {
        margin-bottom: 10px;
        color: #333;
      }

      .info-panel p {
        color: #666;
        line-height: 1.6;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <header class="header">
        <h1>ğŸ„ Mario Game</h1>
        <div class="header-actions">
          <button class="btn secondary" onclick="shareGame()">ğŸ“¤ åˆ†äº«æ¸¸æˆ</button>
          <button class="btn" onclick="restartGame()">ğŸ”„ é‡æ–°å¼€å§‹</button>
          <button class="btn danger" onclick="goHome()">ğŸ  è¿”å›é¦–é¡µ</button>
        </div>
      </header>

      <!-- æ¸¸æˆåŒºåŸŸ -->
      <main class="game-section">
        <div id="game-container">
          <canvas id="game-canvas"></canvas>

          <!-- æ¸¸æˆUI -->
          <div id="game-ui">
            <span class="ui-item">ğŸ† åˆ†æ•°: <span id="score">0</span></span>
            <span class="ui-item">â¤ï¸ ç”Ÿå‘½: <span id="lives">3</span></span>
            <span class="ui-item">ğŸª™ é‡‘å¸: <span id="coins">0</span></span>
          </div>

          <!-- LoadingçŠ¶æ€ -->
          <div id="loading">
            <div class="spinner"></div>
            <div>æ­£åœ¨åŠ è½½æ¸¸æˆ...</div>
          </div>

          <!-- é”™è¯¯çŠ¶æ€ -->
          <div id="error" style="display: none;">
            <h3>âš ï¸ åŠ è½½å¤±è´¥</h3>
            <p id="error-message">æ— æ³•åŠ è½½æ¸¸æˆæ•°æ®</p>
            <div style="margin-top: 20px;">
              <button onclick="location.reload()" class="btn">ğŸ”„ é‡æ–°åŠ è½½</button>
            </div>
          </div>
        </div>
      </main>

      <!-- æ¸¸æˆä¿¡æ¯é¢æ¿ -->
      <section class="info-panel">
        <h3>ğŸ® æ¸¸æˆæ“ä½œè¯´æ˜</h3>
        <p><strong>ç§»åŠ¨:</strong> â† â†’ ç®­å¤´é”®æˆ– A D é”®</p>
        <p><strong>è·³è·ƒ:</strong> â†‘ ç®­å¤´é”®æˆ– W é”®æˆ–ç©ºæ ¼é”®</p>
        <p><strong>å¥”è·‘:</strong> æŒ‰ä½ Shift é”®</p>
        <p><strong>æš‚åœ:</strong> P é”®</p>
      </section>
    </div>

    <script>
      let gameAPI = null

      function restartGame() {
        if (gameAPI) {
          gameAPI.resetGame()
        }
      }

      function shareGame() {
        const url = window.location.href
        navigator.clipboard.writeText(url).then(() => {
          alert('æ¸¸æˆé“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼')
        }).catch(() => {
          prompt('è¯·æ‰‹åŠ¨å¤åˆ¶æ¸¸æˆé“¾æ¥:', url)
        })
      }

      function goHome() {
        if (confirm('ç¡®å®šè¦ç¦»å¼€å½“å‰æ¸¸æˆå—ï¼Ÿ')) {
          window.location.href = '/'
        }
      }

      console.log('ğŸ® Mario Game - Play Mode Initialized')
    </script>

    <script type="module" src="/src/play.ts"></script>
  </body>
</html>