<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Mario Game - Direct Play</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            background: linear-gradient(to bottom, #5C94FC, #87CEEB);
            font-family: 'Courier New', monospace;
            padding: 5px;
            box-sizing: border-box;
            overflow-x: hidden;
        }

        #control-panel {
            margin-bottom: 10px;
            padding: 15px;
            background: rgba(0,0,0,0.8);
            border-radius: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            width: 100%;
            max-width: calc(100vw - 20px);
            box-sizing: border-box;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-primary {
            background: #2196F3;
        }

        .btn-primary:hover {
            background: #0976d2;
        }

        .btn-danger {
            background: #f44336;
        }

        .btn-danger:hover {
            background: #d32f2f;
        }

        #status {
            color: white;
            padding: 10px;
            background: rgba(0,0,0,0.5);
            border-radius: 5px;
            margin-left: auto;
        }

        #instructions {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 250px;
            z-index: 999;
        }

        #instructions h3 {
            color: #FFD700;
            margin-bottom: 10px;
        }

        #instructions ul {
            list-style: none;
            font-size: 14px;
        }

        #instructions li {
            margin: 5px 0;
        }

        #mobile-controls {
            position: absolute;
            top: 80px;
            right: 20px;
            z-index: 999;
        }

        .mobile-btn {
            display: block;
            margin-bottom: 10px;
            padding: 8px 16px;
            background: #FF5722;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            min-width: 120px;
        }

        .mobile-btn:hover {
            background: #E64A19;
        }

        .mobile-btn:active {
            transform: scale(0.95);
        }

        /* Hide mobile controls on desktop by default */
        @media screen and (min-width: 769px) {
            #mobile-controls {
                display: none;
            }
        }

        /* Mobile-specific styles */
        @media screen and (max-width: 768px) {
            #instructions {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
                font-size: 12px;
                padding: 10px;
            }
            
            #instructions h3 {
                font-size: 14px;
            }
            
            #control-panel {
                flex-direction: column;
                align-items: center;
                gap: 5px;
                padding: 10px;
                margin-bottom: 10px;
            }
            
            .btn {
                font-size: 12px;
                padding: 8px 16px;
                min-width: 100px;
            }
            
            #mobile-controls {
                top: 10px;
                right: 10px;
                left: auto;
            }
        }
    </style>
</head>
<body>
    <div id="instructions">
        <h3>üéÆ Controls</h3>
        <ul>
            <li>‚¨ÖÔ∏è‚û°Ô∏è Arrow Keys - Move</li>
            <li>‚¨ÜÔ∏è Up / Space - Jump</li>
            <li>‚¨áÔ∏è Down - Crouch</li>
            <li>‚ö° Shift - Run</li>
            <li>‚ùå X - Action</li>
            <li>‚è∏Ô∏è P - Pause</li>
            <li>üì± On mobile: Use virtual buttons</li>
        </ul>
    </div>

    <div id="mobile-controls">
        <button class="mobile-btn" onclick="toggleVirtualGamepad()">Toggle Controls</button>
        <button class="mobile-btn" onclick="toggleInstructions()">Toggle Help</button>
        <button class="mobile-btn" onclick="toggleVibration()">Toggle Vibration</button>
    </div>

    <div id="control-panel">
        <button class="btn btn-primary" onclick="loadLevel1()">Level 1</button>
        <button class="btn btn-primary" onclick="loadLevel2()">Level 2</button>
        <button class="btn btn-primary" onclick="loadLevel3()">Level 3</button>
        <button class="btn" onclick="loadTestLevel()">Test Level</button>
        <button class="btn" onclick="loadRandomLevel()">Random Level</button>
        <button class="btn btn-danger" onclick="clearLevel()">Clear</button>
        <button class="btn btn-danger" onclick="resetGame()">Reset</button>
        <div id="status">Ready</div>
    </div>

    <div id="app" style="width: 100%; max-width: 100vw; flex: 1;"></div>

    <!-- Âä†ËΩΩÊ∏∏ÊàèÂºïÊìé -->
    <script type="module">
        import './src/main.ts';

        window.setStatus = function(text) {
            document.getElementById('status').textContent = text;
        }

        // Á≠âÂæÖAPIÂä†ËΩΩ
        setTimeout(() => {
            if (window.MarioGameAPI) {
                window.setStatus('‚úÖ Game Ready');
                console.log('Game API loaded successfully');
            } else {
                window.setStatus('‚ùå API Error');
            }
        }, 1000);

        // Level 1 - Classic
        window.loadLevel1 = function() {
            if (!window.MarioGameAPI) {
                alert('Game not loaded yet!');
                return;
            }

            const api = window.MarioGameAPI;
            window.setStatus('Loading Level 1...');

            api.clearLevel();

            // Âú∞Èù¢
            api.addPlatform(0, 500, 3000, 76, 'ground');

            // ÂºÄÂßãÂπ≥Âè∞
            for (let i = 0; i < 3; i++) {
                api.addPlatform(200 + i * 150, 400 - i * 50, 100, 20, 'platform');
            }

            // ÈáëÂ∏Å
            for (let i = 0; i < 10; i++) {
                api.addCoin(250 + i * 50, 300);
            }

            // ÁÆ°ÈÅì
            api.addPlatform(800, 400, 64, 100, 'pipe');
            api.addPlatform(1000, 350, 64, 150, 'pipe');

            // Á†ñÂùóÈò∂Ê¢Ø
            for (let i = 0; i < 5; i++) {
                api.addPlatform(1200 + i * 32, 500 - i * 32, 32 * (5 - i), 32, 'brick');
            }

            // ÈóÆÂè∑ÊñπÂùó
            api.addPlatform(1500, 350, 32, 32, 'question');
            api.addPlatform(1540, 350, 32, 32, 'question');
            api.addPowerUp(1500, 318, 'mushroom');
            api.addCoin(1540, 318);

            // Êïå‰∫∫
            api.addEnemy(400, 450, 'goomba');
            api.addEnemy(600, 450, 'goomba');
            api.addEnemy(1300, 450, 'koopa');

            // Á©∫‰∏≠Âπ≥Âè∞ÊåëÊàò
            for (let i = 0; i < 5; i++) {
                api.addPlatform(1700 + i * 120, 350 - Math.sin(i) * 50, 80, 20, 'platform');
                api.addCoin(1740 + i * 120, 300 - Math.sin(i) * 50);
            }

            // ÁªàÁÇπ
            api.addPlatform(2500, 200, 64, 300, 'pipe');
            api.addPowerUp(2400, 150, 'star');

            api.setPlayerStart(100, 400);
            api.buildLevel();
            api.startGame();

            window.setStatus('Level 1 Loaded');
        }

        // Level 2 - Underground
        window.loadLevel2 = function() {
            if (!window.MarioGameAPI) {
                alert('Game not loaded yet!');
                return;
            }

            const api = window.MarioGameAPI;
            window.setStatus('Loading Level 2...');

            api.clearLevel();

            // Âú∞‰∏ãÁéØÂ¢É
            api.addPlatform(0, 550, 3000, 50, 'underground');
            api.addPlatform(0, 0, 3000, 100, 'underground');

            // Ëø∑ÂÆ´Âπ≥Âè∞
            for (let i = 0; i < 10; i++) {
                const y = i % 2 === 0 ? 450 : 200;
                api.addPlatform(300 + i * 200, y, 120, 30, 'underground');
                api.addCoin(360 + i * 200, y - 50);
            }

            // Êïå‰∫∫
            api.addEnemy(500, 500, 'goomba');
            api.addEnemy(900, 500, 'koopa');
            api.addEnemy(1300, 500, 'goomba');

            // ÈÅìÂÖ∑
            api.addPowerUp(1000, 400, 'flower');
            api.addPowerUp(1500, 150, 'mushroom');

            api.setPlayerStart(100, 450);
            api.buildLevel();
            api.startGame();

            window.setStatus('Level 2 Loaded');
        }

        // Level 3 - Sky
        window.loadLevel3 = function() {
            if (!window.MarioGameAPI) {
                alert('Game not loaded yet!');
                return;
            }

            const api = window.MarioGameAPI;
            window.setStatus('Loading Level 3...');

            api.clearLevel();

            // ÊúÄÂ∞èÂú∞Èù¢
            api.addPlatform(0, 550, 200, 50, 'ground');
            api.addPlatform(2800, 550, 200, 50, 'ground');

            // ‰∫ëÊúµÂπ≥Âè∞
            for (let i = 0; i < 20; i++) {
                const x = 200 + i * 130;
                const y = 400 - Math.sin(i * 0.5) * 100;
                api.addPlatform(x, y, 80, 20, 'platform');

                if (i % 3 === 0) {
                    api.addCoin(x + 40, y - 50);
                }
            }

            // Á©∫‰∏≠Êïå‰∫∫
            api.addEnemy(500, 300, 'firebar');
            api.addEnemy(1000, 250, 'firebar');
            api.addEnemy(1500, 300, 'firebar');

            // ÈÅìÂÖ∑
            api.addPowerUp(800, 200, 'star');
            api.addPowerUp(1600, 200, 'flower');

            api.setPlayerStart(50, 450);
            api.buildLevel();
            api.startGame();

            window.setStatus('Level 3 Loaded');
        }

        // Test Level
        window.loadTestLevel = function() {
            if (!window.MarioGameAPI) {
                alert('Game not loaded yet!');
                return;
            }

            const api = window.MarioGameAPI;
            window.setStatus('Loading Test Level...');

            api.clearLevel();

            // ÁÆÄÂçïÊµãËØïÂÖ≥Âç°
            api.addPlatform(0, 500, 2000, 76, 'ground');
            api.addPlatform(300, 400, 100, 20, 'platform');
            api.addPlatform(500, 350, 100, 20, 'platform');
            api.addPlatform(700, 300, 100, 20, 'platform');

            // ÊµãËØïÊâÄÊúâÂÖÉÁ¥†
            api.addCoin(350, 350);
            api.addCoin(550, 300);
            api.addCoin(750, 250);

            api.addEnemy(400, 450, 'goomba');
            api.addEnemy(600, 450, 'koopa');

            api.addPowerUp(800, 250, 'mushroom');
            api.addPowerUp(900, 250, 'flower');
            api.addPowerUp(1000, 250, 'star');

            api.setPlayerStart(100, 400);
            api.buildLevel();
            api.startGame();

            window.setStatus('Test Level Loaded');
        }

        // Random Level
        window.loadRandomLevel = function() {
            if (!window.MarioGameAPI) {
                alert('Game not loaded yet!');
                return;
            }

            const api = window.MarioGameAPI;
            window.setStatus('Generating Random Level...');

            api.clearLevel();

            // Âú∞Èù¢
            api.addPlatform(0, 500, 3000, 76, 'ground');

            // ÈöèÊú∫Âπ≥Âè∞
            for (let i = 0; i < 15; i++) {
                const x = 200 + Math.random() * 2500;
                const y = 200 + Math.random() * 200;
                const width = 60 + Math.random() * 60;
                api.addPlatform(x, y, width, 20, 'platform');

                // ÈöèÊú∫ÈáëÂ∏Å
                if (Math.random() > 0.5) {
                    api.addCoin(x + width/2, y - 50);
                }
            }

            // ÈöèÊú∫Êïå‰∫∫
            for (let i = 0; i < 8; i++) {
                const x = 300 + Math.random() * 2400;
                const types = ['goomba', 'koopa'];
                api.addEnemy(x, 450, types[Math.floor(Math.random() * types.length)]);
            }

            // ÈöèÊú∫ÈÅìÂÖ∑
            for (let i = 0; i < 3; i++) {
                const x = 400 + Math.random() * 2000;
                const y = 200 + Math.random() * 150;
                const types = ['mushroom', 'flower', 'star'];
                api.addPowerUp(x, y, types[Math.floor(Math.random() * types.length)]);
            }

            api.setPlayerStart(100, 400);
            api.buildLevel();
            api.startGame();

            window.setStatus('Random Level Generated');
        }

        window.clearLevel = function() {
            if (window.MarioGameAPI) {
                window.MarioGameAPI.clearLevel();
                window.setStatus('Level Cleared');
            }
        }

        window.resetGame = function() {
            if (window.MarioGameAPI) {
                window.MarioGameAPI.resetGame();
                window.setStatus('Game Reset');
            }
        }

        // Mobile-specific functions
        window.toggleVirtualGamepad = function() {
            if (window.MarioGameAPI && window.MarioGameAPI.getEngine()) {
                const inputManager = window.MarioGameAPI.getEngine().getInputManager()
                if (inputManager) {
                    inputManager.toggleVirtualGamepad()
                    const isEnabled = inputManager.getVirtualGamepad()?.isEnabled()
                    window.setStatus(isEnabled ? 'Virtual Gamepad ON' : 'Virtual Gamepad OFF')
                }
            }
        }
        
        window.toggleInstructions = function() {
            const instructions = document.getElementById('instructions')
            if (instructions.style.display === 'none') {
                instructions.style.display = 'block'
            } else {
                instructions.style.display = 'none'
            }
        }
        
        window.toggleVibration = function() {
            if (window.MarioGameAPI && window.MarioGameAPI.getEngine()) {
                const inputManager = window.MarioGameAPI.getEngine().getInputManager()
                const mobileDetector = window.MarioGameAPI.getEngine().getMobileDetector()
                if (inputManager && mobileDetector.supportsVibration) {
                    // This is a simple toggle - in a real app you'd want to store this preference
                    window.vibrationEnabled = !window.vibrationEnabled
                    inputManager.setVibrationEnabled(window.vibrationEnabled)
                    window.setStatus(window.vibrationEnabled ? 'Vibration ON' : 'Vibration OFF')
                } else {
                    window.setStatus('Vibration not supported')
                }
            }
        }
        
        // Initialize vibration state
        window.vibrationEnabled = true
        
        // Device detection and mobile setup
        window.setupMobileMode = function() {
            if (window.MarioGameAPI && window.MarioGameAPI.getEngine()) {
                const mobileDetector = window.MarioGameAPI.getEngine().getMobileDetector()
                const deviceType = mobileDetector.getDeviceType()
                
                console.log('Device type:', deviceType)
                
                // Show mobile controls on touch devices
                if (mobileDetector.shouldShowVirtualControls) {
                    document.getElementById('mobile-controls').style.display = 'block'
                    // Auto-hide instructions on small screens
                    if (deviceType === 'mobile') {
                        setTimeout(() => {
                            document.getElementById('instructions').style.display = 'none'
                        }, 5000) // Hide after 5 seconds on mobile
                    }
                }
                
                window.setStatus(`Device: ${deviceType}${mobileDetector.supportsVibration ? ' (Vibration)' : ''}`)
            }
        }

        // Setup mobile mode after API is loaded
        setTimeout(() => {
            window.setupMobileMode()
        }, 1000)

        // Ëá™Âä®Âä†ËΩΩÁ¨¨‰∏ÄÂÖ≥
        setTimeout(() => {
            window.loadLevel1();
        }, 1500);
    </script>
</body>
</html>