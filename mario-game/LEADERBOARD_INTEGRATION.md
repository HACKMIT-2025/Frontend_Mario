# ğŸ† Mario Game æ’è¡Œæ¦œé›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

Marioæ¸¸æˆç°åœ¨é›†æˆäº†å®Œæ•´çš„æ’è¡Œæ¦œç³»ç»Ÿï¼Œæ”¯æŒï¼š
- é€šå…³æˆç»©æäº¤
- å®æ—¶æ’è¡Œæ¦œæ˜¾ç¤º
- ç©å®¶ä¸ªäººè®°å½•
- å®Œç¾é€šå…³æ ‡è®°
- å¤šç§æ’åºæ–¹å¼

## ğŸ® æ¸¸æˆæ¨¡å¼æ”¯æŒ

### 1. ä¸»æ¸¸æˆæ¨¡å¼ (main.ts)
- **æ–‡ä»¶**: `src/main.ts`
- **ç‰¹ç‚¹**: æœ¬åœ°å›ºå®šå…³å¡
- **æ’è¡Œæ¦œæ”¯æŒ**: âŒ **ä¸æ”¯æŒ**
- **åŸå› **: ä½¿ç”¨æœ¬åœ°ç¡¬ç¼–ç å…³å¡ï¼Œæ— å…³å¡IDæ¥æº

### 2. Playæ¨¡å¼ (play.ts)
- **æ–‡ä»¶**: `src/play.ts`
- **ç‰¹ç‚¹**: ä»APIåŠ¨æ€åŠ è½½å…³å¡
- **æ’è¡Œæ¦œæ”¯æŒ**: âœ… **æ”¯æŒ**
- **å…³å¡IDæ¥æº**: URLå‚æ•° `?levelId=123` æˆ– `?id=123`
- **é»˜è®¤å…³å¡ID**: 2

### 3. Embedæ¨¡å¼ (embed.ts)
- **æ–‡ä»¶**: `src/embed.ts`
- **ç‰¹ç‚¹**: åµŒå…¥åˆ°å…¶ä»–é¡µé¢ï¼Œä»APIåŠ è½½å…³å¡
- **æ’è¡Œæ¦œæ”¯æŒ**: âœ… **æ”¯æŒ**
- **å…³å¡IDæ¥æº**: URLå‚æ•° `?levelId=123` æˆ– `?id=123`
- **é»˜è®¤å…³å¡ID**: 3

## ğŸ”§ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **VictoryModal** (`src/ui/VictoryModal.ts`)
   - é€šå…³å¼¹çª—UIç»„ä»¶
   - æˆç»©æäº¤è¡¨å•
   - æ’è¡Œæ¦œæ˜¾ç¤º

2. **LeaderboardClient** (`src/engine/api/LeaderboardClient.ts`)
   - æ’è¡Œæ¦œAPIå®¢æˆ·ç«¯
   - æˆç»©æäº¤å’ŒæŸ¥è¯¢
   - Backend URL: `https://25hackmit--hackmit25-backend.modal.run`

3. **GameEngine** (`src/engine/GameEngine.ts`)
   - é›†æˆæ’è¡Œæ¦œåŠŸèƒ½
   - æ¡ä»¶æ€§å¯ç”¨æ’è¡Œæ¦œ
   - é€šå…³é€»è¾‘å¤„ç†

### Backendé›†æˆ

- **ä¸»Backend**: `https://25hackmit--hackmit25-backend.modal.run`
- **æ’è¡Œæ¦œè·¯ç”±**: `/api/leaderboard/*`
- **å¥åº·æ£€æŸ¥**: `/api/leaderboard/health`

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¯ç”¨æ’è¡Œæ¦œçš„æ¨¡å¼

```javascript
// Playæ¨¡å¼ - è®¿é—®URL
https://your-domain.com/play.html?levelId=123

// Embedæ¨¡å¼ - åµŒå…¥URL
https://your-domain.com/embed.html?id=456
```

### æ¸¸æˆå†…æ§åˆ¶

- **ç§»åŠ¨**: â† â†’ æ–¹å‘é”®
- **è·³è·ƒ**: â†‘ æ–¹å‘é”®æˆ–ç©ºæ ¼
- **æš‚åœ**: Pé”®
- **é‡å¯**: Ré”®

### é€šå…³æµç¨‹

1. ç©å®¶åˆ°è¾¾ç»ˆç‚¹è§¦å‘é€šå…³
2. ç³»ç»Ÿè®¡ç®—æœ€ç»ˆå¾—åˆ†
3. å¦‚æœå¯ç”¨æ’è¡Œæ¦œï¼Œæ˜¾ç¤ºé€šå…³å¼¹çª—
4. ç©å®¶è¾“å…¥æ˜µç§°ç­‰ä¿¡æ¯
5. æäº¤æˆç»©åˆ°æ’è¡Œæ¦œ
6. æ˜¾ç¤ºå®æ—¶æ’åå’Œæ’è¡Œæ¦œ

## ğŸ“Š å¾—åˆ†è®¡ç®—

```javascript
æœ€ç»ˆå¾—åˆ† = Math.max(0,
  1000 +                              // åŸºç¡€åˆ†
  é‡‘å¸æ•° * 1000 -                      // é‡‘å¸åŠ åˆ†
  æ­»äº¡æ¬¡æ•° * 200 +                     // æ­»äº¡æ‰£åˆ†
  Math.floor(1000 * Math.exp(-0.05 * å®Œæˆæ—¶é—´))  // æ—¶é—´åŠ åˆ†
)
```

## ğŸ† æ’è¡Œæ¦œåŠŸèƒ½

### ç©å®¶ç®¡ç†
- `POST /api/leaderboard/players` - åˆ›å»º/æ³¨å†Œç©å®¶
- `GET /api/leaderboard/players/{nickname}` - è·å–ç©å®¶ä¿¡æ¯

### æˆç»©æäº¤
- `POST /api/leaderboard/scores` - æäº¤æ¸¸æˆæˆç»©

### æ’è¡Œæ¦œæŸ¥è¯¢
- `GET /api/leaderboard/levels/{levelId}` - è·å–å…³å¡æ’è¡Œæ¦œ
- `GET /api/leaderboard/global` - è·å–å…¨å±€æ’è¡Œæ¦œ
- `GET /api/leaderboard/players/{nickname}/records` - ç©å®¶ä¸ªäººè®°å½•

### ç»Ÿè®¡æ•°æ®
- `GET /api/leaderboard/stats/level/{levelId}` - å…³å¡ç»Ÿè®¡ä¿¡æ¯

## ğŸ› ï¸ å¼€å‘å’Œè°ƒè¯•

### æµ‹è¯•æ–‡ä»¶
- `test_victory.html` - é€šå…³åŠŸèƒ½æµ‹è¯•é¡µé¢
- `test_unified_backend_api.py` - Backend APIæµ‹è¯•è„šæœ¬

### è°ƒè¯•æ–¹æ³•

```javascript
// æ£€æŸ¥æ’è¡Œæ¦œçŠ¶æ€
gameAPI.getEngine().isLeaderboardEnabled()

// æ‰‹åŠ¨å¯ç”¨/ç¦ç”¨æ’è¡Œæ¦œ
gameAPI.getEngine().enableLeaderboard(true/false)

// è®¾ç½®å…³å¡ID
gameAPI.getEngine().setLevelId(123)

// æµ‹è¯•é€šå…³å¼¹çª—
const victoryModal = new VictoryModal()
const testData = {
  completionTime: 45000,
  deaths: 2,
  coins: 3,
  score: 1500,
  levelId: 123
}
await victoryModal.show(testData)
```

### æ ·å¼å®šåˆ¶

æ’è¡Œæ¦œå¼¹çª—æ ·å¼ä½äº `src/ui/VictoryModal.css`ï¼Œæ”¯æŒï¼š
- å“åº”å¼è®¾è®¡
- åŠ¨ç”»æ•ˆæœ
- ä¸»é¢˜é¢œè‰²å®šåˆ¶
- å®Œç¾é€šå…³ç‰¹æ•ˆ

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ’è¡Œæ¦œä¸æ˜¾ç¤º**
   - æ£€æŸ¥æ˜¯å¦ä½¿ç”¨æ­£ç¡®çš„æ¸¸æˆæ¨¡å¼ (play.ts æˆ– embed.ts)
   - ç¡®è®¤å…³å¡IDæ˜¯å¦æ­£ç¡®è®¾ç½®
   - æ£€æŸ¥Backendè¿æ¥çŠ¶æ€

2. **æˆç»©æäº¤å¤±è´¥**
   - éªŒè¯BackendæœåŠ¡æ˜¯å¦æ­£å¸¸
   - æ£€æŸ¥ç½‘ç»œè¿æ¥
   - æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

3. **æ ·å¼é—®é¢˜**
   - ç¡®è®¤CSSæ–‡ä»¶æ­£ç¡®å¯¼å…¥
   - æ£€æŸ¥CSSå†²çª

### æ—¥å¿—è¾“å‡º

æ¸¸æˆä¼šè¾“å‡ºè¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—ï¼š
- `ğŸ® è®¾ç½®å…³å¡ID: Xï¼Œæ’è¡Œæ¦œå·²å¯ç”¨`
- `ğŸ† Leaderboard enabled/disabled`
- `ğŸ‰ Victory! Leaderboard disabled for this mode.`

## ğŸ“± ç§»åŠ¨ç«¯æ”¯æŒ

- è‡ªåŠ¨æ˜¾ç¤ºè™šæ‹Ÿæ§åˆ¶å™¨
- å“åº”å¼å¼¹çª—è®¾è®¡
- è§¦æ‘¸å‹å¥½çš„äº¤äº’

## ğŸ”’ å®‰å…¨æ€§

- è¾“å…¥éªŒè¯å’Œæ¸…ç†
- å®‰å…¨çš„APIé€šä¿¡
- é˜²æ­¢SQLæ³¨å…¥å’ŒXSSæ”»å‡»

## ğŸ“ æ›´æ–°æ—¥å¿—

- âœ… é›†æˆæ’è¡Œæ¦œåˆ°ä¸»Backend
- âœ… æ¡ä»¶æ€§å¯ç”¨æ’è¡Œæ¦œåŠŸèƒ½
- âœ… å®Œæ•´çš„é€šå…³å¼¹çª—ç³»ç»Ÿ
- âœ… å®æ—¶æ’åæ˜¾ç¤º
- âœ… å¤šæ¨¡å¼æ”¯æŒ

---

**æ³¨æ„**: åªæœ‰ä»URLè·å¾—åœ°å›¾ä¿¡æ¯ä»¥åŠIDçš„æ¨¡å¼æ‰æ”¯æŒæ’è¡Œæ¦œåŠŸèƒ½ï¼